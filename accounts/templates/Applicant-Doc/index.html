{% extends 'base.html' %}
{% load static %}
{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>


 

    
    
</style>
<input type="hidden" value="{{jpk}}" id="job-id-hidden">
<div class="main-buttons-div">
    <div class="jobs-buttons applied-posted-buttons-mobile all-aplicants-main-div scrolling-wrapper">
<div style="display: flex;" class="buttons-form card">
    <div class="container-fluid " style="cursor: pointer;">
        <div id="mySelectLabel" class="selectBox" style="">
            <div class="input-form margin inputs-right-margin" style="">
                <select style="color: #65676B; border: none;
      padding: 8px 30px; padding-left: 20px;" class="form-select all-applicants-select" id="second_form_select">
                    <option value="All Jobs" id="program" class="first-input-option all-applicants-button nr_of_applicants">All Applicants ({{NoApplicant}})</option>
                </select>
                <div class="" style="display: flex; align-items: center;">
                    <img style="cursor: pointer; display: none;" class="white-icon"
                        src="/static/img/white-dropdown-icon.svg" alt="">
                        
                </div>
                    <div style="" class="overSelect"></div>
            </div>
            <div id="all-applicants-dropdown" class="selectOptions dropdown-elements all-applicants-dropdown" style="z-index: 99;">
       <label for="mutual1" id="qualify" class="profileDropDown-content profileDropDown-text all-applicants-dropdown-content"><input id="mutual1" style="display: none;" type="checkbox" class="input_type"
            onchange="checkboxStatusChange()" value="Qualified" name="Qualified" />Qualified ({{NoApplicantQualified}})</label>
        <label style="" class="profileDropDown-content all-applicants-dropdown-content profileDropDown-text all-applicants-dropdown-content"><input style="display: none;" type="checkbox" class="input_type"
        value="Not Qualified" name="Not Qualified" />Not Qualified ({{NoApplicantNQualified}})</label>
        <label for="mutual2" id="qualify2" class="profileDropDown-content all-applicants-dropdown-content profileDropDown-text documents-for-work-permit-label-dropdown">Documents for Work Permit ({{userWorkPermit}})</label>
        <label style="" class="profileDropDown-content all-applicants-dropdown-content profileDropDown-text your-work-permit-is-here-label-dropdown">Your Work Permit is Here ({{ready_users_count}})</label>         
        
         <label title="Select an option to click here" class="move-phase-button">Select to move</label>

      </div>
      
    </div>
    </div>
</div>
    </div>
    </div>



    <div class="jobs-main-div">
        {% include 'Applicant-Doc/left-applicant.html'%}
        {% include 'Applicant-Doc/right-applicant.html'%}
        
    </div>
       
        <div class="bg-add-and-edit" style="display: none;">
        <div class="popup add-experience under-container-mutual-mutual-stats">
            <div class="edit-profile-title mutual-titles-pop-ups-stats"><span class="name-document">Document</span></div>
            <form id="upload-form-recruiter" enctype="multipart/form-data" class="sign-up-form forms-inputs-placeholder">
                {% csrf_token %}
            
                <input type="hidden" name="document_id" id="document_id" value="">
                <input type="hidden" name="user_id" id="user_id">
                <div class="drop-area" id="drop-area">
                    <img src="{% static 'img/upload docs.svg' %}" alt="">
                    <div class="file-upload">Select a file to upload</div>
                    <div class="under-upload-file" id="second-line">or drag and drop it here</div>
                    <input type="file"  name="document" id="id_document"  accept=".pdf, .jpg, .jpeg, .png, .svg"  style="display: none;">

                </div>
                <div class="save-button save-button-edit-profile-photo">
                    <input id="close-popup" type="button" name="back" title="Back to Profile" class="back-input font-fam back-save-buttons" value="Back">
                    <input id="save-button" title="Save Profile Data" name="save" type="submit" class="save-submit-input font-fam back-save-buttons" value="Save">
                </div>
            </form>
        </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
        function Qualified(){
        window.location="{% url 'qualified-applicant' jpk %}";
    }
    function NoQualified(){
        window.location="{% url 'nonqualified-applicant' jpk %}";
    }
    function AllApplicant(){
        window.location="{% url 'applicant' jpk %}";
    }
</script>
<script>
function ChangeDiv() {
    console.log("test");
    // Hide the first div and show the second div
    $(".documents-for-work-permit-form-content").hide();
    $(".your-work-permit-is-here-form-content").show();
}

</script>

<script>
    function penndingFunction(id){
        console.log("approved: "+$("#user_id").val());
        var user_id = $("#user_id").val();
        var document_id = id;
        $.ajax({
            type: "POST",
            url: '/return_pennding_document/',
            data: {
                document_id : document_id,
                user_id:user_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),

            },
            success: function(response) {
                   
                    getUser(user_id);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
    };
    function ApproveFunction(id){
        console.log("approved: "+$("#user_id").val());
        var user_id = $("#user_id").val();
        var document_id = id;
        $.ajax({
            type: "POST",
            url: '/approve_document_user/',
            data: {
                document_id : document_id,
                user_id:user_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),

            },
            success: function(response) {
                   
                    getUser(user_id);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
    };
    function RefuseFunction(id){
        console.log("approved: "+$("#user_id").val());
        var user_id = $("#user_id").val();
        var document_id = id;
        $.ajax({
            type: "POST",
            url: '/refused_document_user/',
            data: {
                document_id : document_id,
                user_id:user_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),

            },
            success: function(response) {
                   
                    getUser(user_id);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
    };
    function getDocument(element) {
        const dataNumber = element.getAttribute('data-number');
        const dataDocumentId = element.getAttribute('data-document-id');
        var userId = document.getElementById("user_id").value;
        const downloadUrl = `/download_document/${dataNumber}/${userId}`;
    
        // Create an invisible anchor element to trigger the download.
        const downloadLink = document.createElement('a');
        downloadLink.href = downloadUrl;
        downloadLink.target = '_blank';
        downloadLink.style.display = 'none';

        document.body.appendChild(downloadLink);
        downloadLink.click();
        
        document.body.removeChild(downloadLink);
        }
</script>

        <script>
            $(".job-left-row input").click(function (e) {
                // Do something
                e.stopPropagation();
            });
        </script>
<script>
    function openPopUp(element) {
        $('.bg-add-and-edit, .popup').css("display", "flex");
        var titleValue = $(element).attr('title');
        var dataNumberValue = $(element).attr('data-number');
        $('#document_id').val(dataNumberValue);
        $('.name-document').text(titleValue);
    }
</script>
<script>
    $(document).ready(function() {
       

      $('#id_document').on('change', function() {
        
        var fileInput = this.files[0];
        

        if (fileInput) {
          // Check the file extension
          var allowedExtensions = ['.pdf', '.jpg', '.jpeg', '.png', '.svg'];
          var fileExtension = fileInput.name.slice(((fileInput.name.lastIndexOf(".") - 1) >>> 0) + 2);
          if (allowedExtensions.indexOf('.' + fileExtension.toLowerCase()) === -1) {
            // Invalid file extension, update the input border color
            $('#id_document').css('border', '2px solid red');
            $('#error').css('display', 'block');
            $('#error').css('color', 'red');
          } else {
            // Reset the input border color if the file is valid
            $('#error').css('display', 'none');

            $('#id_document').css('border', '1px solid #ffff');
          }
        }
      });

      $(document).ready(function() {
            $('#upload-form-recruiter').submit(function(e) {
                e.preventDefault();

                var formData = new FormData(this);

                // Get the current domain (including protocol, domain, and port)
                var currentDomain = window.location.origin;

                // Construct the URL by appending the path
                var uploadURL = currentDomain + '/upload_documents_recruiter/';
                var userid = formData.get('user_id');
                $.ajax({
                type: 'POST',
                url: uploadURL,
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    $('.bg-add-and-edit, .popup').css("display", "none");
                    getUser(userid);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
  });
});


    });
</script>
    



    


        {% endblock content %}