{% extends 'base.html' %}

{% load static %}
<title>{% block title %}Worki - Applicants{% endblock %}</title>
{% block content %}

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

.job-left-row:first-child {
        margin-top: 0; /* Remove margin-top for the first user element */
    }
  
</style>
<input type="hidden" value="{{jpk}}" id="job-id-hidden">
{% include 'Match/Filters/filters.html'%}


    <div class="jobs-main-div">
        {% include 'Applicant-Doc/left-applicant.html'%}
        {% include 'Applicant-Doc/right-applicant.html'%}
        
    </div>
       
        <div class="bg-add-and-edit" style="display: none;">
        <div class="popup add-experience under-container-mutual-mutual-stats">
            <div class="edit-profile-title mutual-titles-pop-ups-stats"><span class="name-document">Document</span></div>
            <form id="upload-form-recruiter" enctype="multipart/form-data" class="sign-up-form forms-inputs-placeholder">
                {% csrf_token %}
            
                <input type="hidden" name="document_id" id="document_id" value="">
                <input type="hidden" name="user_id" id="user_id">
                <div class="drop-area" id="drop-area">
                    <img src="{% static 'img/upload docs.svg' %}" alt="">
                    <div class="file-upload">Select a file to upload</div>
                    <input type="file"  name="document" id="id_document"  accept=".pdf, .jpg, .jpeg, .png, .svg"  style="display: none;">

                </div>
                <div class="save-button save-button-edit-profile-photo">
                    <input id="close-popup" type="button" name="back" title="Back to Profile" class="back-input font-fam back-save-buttons" value="Back">
                    <input id="save-button" title="Save Profile Data" name="save" type="submit" class="save-submit-input font-fam back-save-buttons" value="Save">
                </div>
            </form>
        </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
        function Qualified(){
        window.location="{% url 'qualified-applicant' jpk %}";
    }
    function NoQualified(){
        window.location="{% url 'nonqualified-applicant' jpk %}";
    }
    function AllApplicant(){
        window.location="{% url 'applicant' jpk %}";
    }
</script>
<script>
function ChangeDiv() {
    console.log("test");
    // Hide the first div and show the second div
    $(".documents-for-work-permit-form-content").hide();
    $(".your-work-permit-is-here-form-content").show();
}

</script>

<script>
    function penndingFunction(id){
        console.log("approved: "+$("#user_id").val());
        var user_id = $("#user_id").val();
        var document_id = id;
        $.ajax({
            type: "POST",
            url: '/return_pennding_document/',
            data: {
                document_id : document_id,
                user_id:user_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),

            },
            success: function(response) {
                   
                    getUser(user_id);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
    };
    function ApproveFunction(id){
        console.log("approved: "+$("#user_id").val());
        var user_id = $("#user_id").val();
        var document_id = id;
        $.ajax({
            type: "POST",
            url: '/approve_document_user/',
            data: {
                document_id : document_id,
                user_id:user_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),

            },
            success: function(response) {
                   
                    getUser(user_id);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
    };
    function RefuseFunction(id){
        console.log("approved: "+$("#user_id").val());
        var user_id = $("#user_id").val();
        var document_id = id;
        $.ajax({
            type: "POST",
            url: '/refused_document_user/',
            data: {
                document_id : document_id,
                user_id:user_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),

            },
            success: function(response) {
                   
                    getUser(user_id);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
    };
    function getDocument(element) {
        const dataNumber = element.getAttribute('data-number');
        const dataDocumentId = element.getAttribute('data-document-id');
        var userId = document.getElementById("user_id").value;
        const downloadUrl = `/download_document/${dataNumber}/${userId}`;
    
        // Create an invisible anchor element to trigger the download.
        const downloadLink = document.createElement('a');
        downloadLink.href = downloadUrl;
        downloadLink.target = '_blank';
        downloadLink.style.display = 'none';

        document.body.appendChild(downloadLink);
        downloadLink.click();
        
        document.body.removeChild(downloadLink);
        }
</script>

        <script>
            $(".job-left-row input").click(function (e) {
                // Do something
                e.stopPropagation();
            });
        </script>
<script>
    function openPopUp(element) {
        $('.bg-add-and-edit, .popup').css("display", "flex");
        var titleValue = $(element).attr('title');
        var dataNumberValue = $(element).attr('data-number');
        $('#document_id').val(dataNumberValue);
        $('.name-document').text(titleValue);
    }
</script>
<script>
    $(document).ready(function() {
       

      $('#id_document').on('change', function() {
        
        var fileInput = this.files[0];
        

        if (fileInput) {
          // Check the file extension
          var allowedExtensions = ['.pdf', '.jpg', '.jpeg', '.png', '.svg'];
          var fileExtension = fileInput.name.slice(((fileInput.name.lastIndexOf(".") - 1) >>> 0) + 2);
          if (allowedExtensions.indexOf('.' + fileExtension.toLowerCase()) === -1) {
            // Invalid file extension, update the input border color
            $('#id_document').css('border', '2px solid red');
            $('#error').css('display', 'block');
            $('#error').css('color', 'red');
          } else {
            // Reset the input border color if the file is valid
            $('#error').css('display', 'none');

            $('#id_document').css('border', '1px solid #ffff');
          }
        }
      });

      $(document).ready(function() {
            $('#upload-form-recruiter').submit(function(e) {
                e.preventDefault();

                var formData = new FormData(this);

                // Get the current domain (including protocol, domain, and port)
                var currentDomain = window.location.origin;

                // Construct the URL by appending the path
                var uploadURL = currentDomain + '/upload_documents_recruiter/';
                var userid = formData.get('user_id');
                $.ajax({
                type: 'POST',
                url: uploadURL,
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    $('.bg-add-and-edit, .popup').css("display", "none");
                    getUser(userid);
                    // Rest of your success handling code
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("Error:", textStatus, errorThrown);
                    // Handle the error
                }
                });
  });
});


    });
</script>
    



    


        {% endblock content %}